{"version":3,"file":"sortRowsFn.js","sources":["../../../src/utils/sortRowsFn.ts"],"sourcesContent":["import { TableInstance, Row, RowModel, AnyGenerics } from '../types'\nimport { SortingFn } from '../features/Sorting'\n\nexport function sortRowsFn<TGenerics extends AnyGenerics>(\n  instance: TableInstance<TGenerics>,\n  rowModel: RowModel<TGenerics>\n): RowModel<TGenerics> {\n  const sortingState = instance.getState().sorting\n\n  const sortedFlatRows: Row<TGenerics>[] = []\n\n  // Filter out sortings that correspond to non existing columns\n  const availableSorting = sortingState.filter(sort =>\n    instance.getColumnCanSort(sort.id)\n  )\n\n  const columnInfoById: Record<\n    string,\n    {\n      sortUndefined?: false | -1 | 1\n      invertSorting?: boolean\n      sortingFn: SortingFn<TGenerics>\n    }\n  > = {}\n\n  availableSorting.forEach(sortEntry => {\n    const column = instance.getColumn(sortEntry.id)!\n\n    columnInfoById[sortEntry.id] = {\n      sortUndefined: column.sortUndefined,\n      invertSorting: column.invertSorting,\n      sortingFn: instance.getColumnSortingFn(sortEntry.id)!,\n    }\n  })\n\n  const sortData = (rows: Row<TGenerics>[]) => {\n    // This will also perform a stable sorting using the row index\n    // if needed.\n    const sortedData = rows.slice()\n\n    sortedData.sort((rowA, rowB) => {\n      for (let i = 0; i < availableSorting.length; i += 1) {\n        const sortEntry = availableSorting[i]!\n        const columnInfo = columnInfoById[sortEntry.id]!\n        const isDesc = sortEntry?.desc ?? false\n\n        if (columnInfo.sortUndefined) {\n          const aValue = rowA.values[sortEntry.id]\n          const bValue = rowB.values[sortEntry.id]\n\n          const aUndefined = typeof aValue === 'undefined'\n          const bUndefined = typeof bValue === 'undefined'\n\n          if (aUndefined || bUndefined) {\n            return aUndefined && bUndefined\n              ? 0\n              : aUndefined\n              ? columnInfo.sortUndefined\n              : -columnInfo.sortUndefined\n          }\n        }\n\n        // This function should always return in ascending order\n        let sortInt = columnInfo.sortingFn(rowA, rowB, sortEntry.id)\n\n        if (sortInt !== 0) {\n          if (isDesc) {\n            sortInt *= -1\n          }\n\n          if (columnInfo.invertSorting) {\n            sortInt *= -1\n          }\n\n          return sortInt\n        }\n      }\n\n      return rowA.index - rowB.index\n    })\n\n    // If there are sub-rows, sort them\n    sortedData.forEach(row => {\n      sortedFlatRows.push(row)\n      if (!row.subRows || row.subRows.length <= 1) {\n        return\n      }\n      row.subRows = sortData(row.subRows)\n    })\n\n    return sortedData\n  }\n\n  return {\n    rows: sortData(rowModel.rows),\n    flatRows: sortedFlatRows,\n    rowsById: rowModel.rowsById,\n  }\n}\n"],"names":["sortRowsFn","instance","rowModel","sortingState","getState","sorting","sortedFlatRows","availableSorting","filter","sort","getColumnCanSort","id","columnInfoById","forEach","sortEntry","column","getColumn","sortUndefined","invertSorting","sortingFn","getColumnSortingFn","sortData","rows","sortedData","slice","rowA","rowB","i","length","columnInfo","isDesc","desc","aValue","values","bValue","aUndefined","bUndefined","sortInt","index","row","push","subRows","flatRows","rowsById"],"mappings":"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"}